\chapterbegin{Nodo}
\label{chp:nodo}
\minitoc

\sectionx{Introducción}
La aplicación implementa el dispositivo de la red, que le permite conectarse a la red creada por el concentrador. El sensor periódicamente envía reportes de datos en intervalos configurados por el concentrador y este responde con mensajes de rastreo.

\sectionx{Arquitectura Hardware}

\subsection*{ARM Cortex M0 (Núcleo radio)}
El núcleo \ac{CM0} en el CC1350 es responsable de la interfaz audio, y traduce complejas instrucciones del núcleo \ac{CM3}  en bits que son enviados a través del enlace radio.  Para el protocolo TI 15.4-Stack, el \ac{CM0} implementa la capa \ac{PHY} de la pila de protocolos. \\

El \textit{firmware} del núcleo de radio no está destinado a ser usado o modificado por la aplicación del desarrollador.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\textwidth]{graphs/fig-simplelink-block-diagram.jpeg}
	\caption{Diagrama de bloques de Simplelink\TM CC13x0}
	\label{fig:diagramaBloquesSimpleLink}
\end{figure}

\subsection*{ARM Cortex M3 (Núcleo del sistema)}

El núcleo \ac{CM3} está diseñado para ejecutar la pila del protocolo inalámbrico desde la capa de enlace hasta la capa de aplicación de usuario. La capa de enlace actúa como interfaz del núcleo de radio cómo un módulo software llamado \textit{RF driver}.

\subsection*{Flash, RAM y periféricos}

El CC1350 contiene en el sistema 128KB de memoria flash programable, 20KB de SRAM, y un amplio rango de periféricos. La memora flash se divide en partes que se pueden borrar de 4KB. El CC1350 también contiene 8kB de caché SRAM que puede ser utilizada para extender la capacidad de la RAM o puede funcionar como una caché normal para incrementar el rendimiento de la aplicación. Otros periféricos incluidos son UART, I2C, I2S, AES, TRNG, temperatura y monitor de la batería.


\sectionx{TI-RTOS}

TI-RTOS es un entorno operativo para proyectos TI 15.4-Stack en dispositivos CC1350. El kernel TI-RTOS es una versión adaptada del kernel SYS/BIOS y funciona como un sistema operativo con controladores en tiempo real, con prioridades, multitarea y herramientas para la sincronización y planificación.

% TODO Completar esta sección

\sectionx{Arquitectura de la aplicación}

En la figura \ref{fig:fig-example-application-block-diagram} se muestra el diagrama de bloques de la aplicación del nodo.  

\begin{figure}[h]
	\centering
	\includegraphics[width=0.8\textwidth]{graphs/fig-example-application-block-diagram}
	\caption{Diagrama de bloques de la aplicación}
	\label{fig:fig-example-application-block-diagram}
\end{figure}
% TODO Modificar imagen para 
Descripción a alto nivel de varios bloques de la figura \ref{fig:fig-example-application-block-diagram}:

\begin{description}
	\item[Aplication:] Este bloque .....
	\item[Logical Link Controller:] Implementa varias funciones específicas del IEEE 802.15.4 o Wi-SUN (para una configuración \textit{frequency-hopping}) para formación, conexión y reconexión de la red. 
	\item[TI-RTOS Start-up Code:] Inicializa la aplicación.
	\item[Utility Functions] Provee varias utilidades para usar LCD, temporizadores, botones y más.
	\item[Application-Specific Functions:] Implementa funciones como guardado de datos, y provee una interfaz para gestionar pulsaciones botones o mostrar información esencial en un LCD.
	\item[TI 15.4-Stack API Module (API MAC Module):] Este módulo proporciona una interfaz para gestión y los servicios de datos del 802.15.4 stack mediante el módulo \ac{ICall}.
\end{description}

\sectionx{Función de inicio}

La función \textit{main()} dentro del archivo main.c es el punto de inicio de la ejecución de la aplicación. En este punto los componentes relaciones con la placa son inicializados. Las tareas se configuran en eta función, inicializando los parámetros necesarios como su prioridad y su tamaño en la pila. En el paso final, las interrupciones se habilitan y el planificador \textit{SYS/BIOS} se inicia llamando a \textit{BIOS\_start()}.


\sectionx{Arquitectura general de la aplicación}

Esta sección describe como la tarea de la aplicación esta estructura en más detalle. 

\subsection*{Función de inicio de la aplicación}

\begin{wrapfigure}{r}{0.4\textwidth}
	\begin{center}
		\includegraphics[width=0.4\textwidth]{graphs/TaskFxn.png}
	\end{center}
	\caption{Diagrama de estados de la función de inicio}
\end{wrapfigure}

Después de que la tarea sea construida y el planificador \textit{SYS/BIOS} se inicie, la función que se le pasa durante la construcción de la tarea es ejecutada cuando la tarea está lista.\\

Las funciones de gestión de la energía son inicializadas aquí y el módulo \ac{ICall} se inicia con la función \textit{ICall\_init()}. La dirección IEEE address (programada por TI) es obtenida desde la memoria flash. La tarea de la aplicación (Aplicación Sensor) es inicializada y ejecutada.

\textit{Sensor\_init()} establece varios parámetros de configuración, así como:

\begin{itemize}
	\item Inicializa las estructuras para los datos
	\item Inicializa el TI 15.4-Stack
	\item Configura la seguridad y el \textit{Logical Link Controller}
	\item Registra las funciones de retorno MAC
\end{itemize} 

\subsection*{Función principal}

% TODO completar con: http://software-dl.ti.com/simplelink/esd/simplelink_cc13x0_sdk/1.60.00.21/exports/docs/ti154stack/html/ti154stack/application-overview.html

\sectionx{Bluetooth Low Energy Advertiser}
% TODO completar con: http://software-dl.ti.com/simplelink/esd/simplelink_cc13x0_sdk/1.60.00.21/exports/docs/ti154stack/html/ti154stack/configuring-stack.html#configuring-uble-stack



\chapterend{}