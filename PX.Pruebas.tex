\chapterbegin{Pruebas}
\label{chp:pruebas}
\minitoc

\section{Prueba en entorno real}

\subsection{Introducción}

Esta prueba consiste en simular el funcionamiento de la red en un entorno lo más parecido a un caso de uso real. Para ello se ha instalado el concentrador en un punto fijo como se observa en la figura \ref{fig:pruebaLocalizacion} (marcador central del círculo) y el nodo se ha ido cambiando de posición. Con esta prueba se ha comprobado el alcance de la red, el envío de los mensajes de la web física por Bluetooth y las reconexiones de los nodos a la red.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.7\textwidth]{graphs/pruebaLocalizacion}
	\caption{Posición del concentrador y nodo durante la prueba en el punto de máximo alcance}
	\label{fig:pruebaLocalizacion}
\end{figure}

\subsection{Metodología}

Cómo se ha indicado anteriormente, el concentrador se ha ubicado en un punto fijo que estuviera elevado, por ello se ha situado en el balcón de la 2º planta de un edificio. Y el nodo se ha ido cambiado de posición hasta llegar a la distancia máxima y que este perdiera la conexión con el concentrador, después de esto se ha vuelto a acercar para comprobar la reconexión a la red.

\subsection{Resultados}

Después de realizar las pruebas se ha estimado la distancia máxima a la que el nodo puede situarse para poder mantener la conexión que es de 400m, pero esta medida mejoraría cambiando la antena y utilizando un amplificador en transmisión lo que quedará como una línea futura de mejora de este proyecto.\\

En cuanto a la reconexión del nodo, ha sido todo un éxito. Después de repetir la desconexión y reconexión del nodo varías veces, en todas de ellas la ha realizado sin problemas. Y además no ha dejado de enviar los mensajes de la web física en ningún momento durante la prueba.\\
\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{graphs/pruebaEstadisticas}
	\caption{Estadísticas de la red después de la prueba}
	\label{fig:pruebaEstadisticas}
\end{figure}
Finalmente en la figura \ref{fig:pruebaEstadisticas} se observan las estadísticas que ha recogido la red después de las pruebas,  donde se tiene que el concentrador ha recibido 26 peticiones del nodo para que le envíe la configuración (esta petición se realiza después de una conexión o reconexión)  y 222 mensajes de tipo "Sensor" que son los que el nodo envía periódicamente con datos de temperatura, batería, estadísticas y algunos parámetros más.

\section{Prueba de consumo}
\subsection{Introducción}
Para una exitosa implementación del \ac{IOT} uno de los requisitos más importantes es un consumo eficiente del sistema.\\

La comunicación inalámbrica entre los nodos comienza a ser un problema cuando la fuente de alimentación es limitada. Un sistema que pueda funcionar con una sola pila AAA durante años es lo ideal en el \ac{IOT} \cite{mahmoud2016study}. Por ello, durante el desarrollo de este proyecto se ha utilizado como protocolo inalámbrico el IEEE 802.15.4, que destaca su bajo consumo.\\

\subsection{Medida del consumo}

Para realizar la medida de consumo se ha utilizado el multímetro digital Keysight 34411A, que proporciona 6 dígitos y medio de resolución o una velocidad de muestreo de 50000 muestras/s a una resolución inferior. \cite{multimeter4411A}\\

Para el control del multímetro se ha utilizado dos programas de LabView, uno de ellos permite obtener datos a la máxima velocidad de muestreo aunque eso limite la resolución a 4 dígitos (figura \ref{fig:capturaRapida}) y el otro programa permite tomar datos promediados en intervalos de tiempo (figura \ref{fig:capturaPromedio}).

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{graphs/CapturaRapida.png}
	\caption{Programa de LabView para captura rápida}
	\label{fig:capturaRapida}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{graphs/CapturaPromedio.png}
	\caption{Programa de LabView para captura en promedio}
	\label{fig:capturaPromedio}
\end{figure}

\subsection{Resultados}

Aunque el objetivo de esta prueba es conocer el consumo medio de corriente del nodo. Antes de nada se necesita conocer que fondo de escala utilizar en el multímetro para la medida en promedio, para ello se hace uso del programa de captura a máxima frecuencia de muestreo, donde se obtiene la corriente instantánea máxima que consume el nodo, unos 15 mA (figura \ref{fig:datosCapturaRapida}).

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{graphs/capturaRapidaDatos.png}
	\caption{Consumo en mA del nodo a la máxima frecuencia de muestreo}
	\label{fig:datosCapturaRapida}
\end{figure}

Finalmente, utilizando el programa de medida promediada de LabView con un fondo de escala de 100mA, realizamos una medida de la corriente promedio durante 50 ciclos de subidas al servidor. Con esta configuración se obtiene que el consumo medio de un nodo es de 169.6 $\micro A$, lo que equivale a más de 5 meses de funcionamiento utilizando una pila de botón CR 2477. 



\chapterend{}